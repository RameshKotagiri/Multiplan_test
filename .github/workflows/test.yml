package terraform

# Deny if any bucket lacks kms_key_id
deny[msg] {
    resource := input.plan.resource_changes[_]
    resource.type == "oci_objectstorage_bucket"
    resource.change.actions[_] == "create"
    not resource.change.after.kms_key_id
    msg := sprintf("Bucket '%s' does not have kms_key_id defined", [resource.change.after.name])
}

# Deny if kms_key_id is empty
deny[msg] {
    resource := input.plan.resource_changes[_]
    resource.type == "oci_objectstorage_bucket"
    resource.change.actions[_] == "create"
    resource.change.after.kms_key_id == ""
    msg := sprintf("Bucket '%s' has an empty kms_key_id", [resource.change.after.name])
}
